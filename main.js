(()=>{"use strict";function t(t,e,n,r,o,u,c){var i=e.content.querySelector(".group__element").cloneNode(!0),a=i.querySelector(".group__image"),l=i.querySelector(".group__title"),s=i.querySelector(".group__button"),p=i.querySelector(".group__button-delete"),d=i.querySelector(".group__like");return d.textContent=t.likes.length||"",t.owner._id!==r&&p.remove(),t.likes.some((function(t){return t._id===r}))&&s.classList.add("group__button_active"),a.setAttribute("src",t.link),a.setAttribute("alt",t.name),a.addEventListener("click",(function(){return n(t)})),l.textContent=t.name,s.addEventListener("click",(function(e){t.likes.some((function(t){return t._id===r}))?c(t._id).then((function(n){t=n,d.textContent=t.likes.length||"",function(t){t.classList.remove("group__button_active")}(e.target)})).catch((function(t){return console.log(t)})):u(t._id).then((function(n){t=n,d.textContent=t.likes.length||"",function(t){t.classList.add("group__button_active")}(e.target)})).catch((function(t){return console.log(t)}))})),p.addEventListener("click",(function(){o(t._id).then((function(){return function(t){t.remove()}(i)})).catch((function(t){return console.log(t)}))})),i}function e(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",(function(e){return r(e,t)}))}function n(t){t.classList.add("popup_opened"),document.addEventListener("keydown",(function(e){return r(e,t)}))}function r(t,n){"Escape"===t.key&&e(n)}function o(t,e){var n=e.querySelectorAll(t.inputSelector);return console.log(t.inputSelector),Array.from(n).every((function(t){return t.validity.valid}))}function u(t,e){console.log(e),document.querySelectorAll(e.inputSelector).forEach((function(t){t.classList.remove(e.inputErrorClass),t.nextElementSibling.textContent=""})),t.reset(),document.querySelector(e.submitButtonSelector).disabled=!o(e,t)}var c="https://around.nomoreparties.co/v1/wff-cohort-16/",i={"Content-Type":"application/json",Authorization:"e53a7134-226f-47c6-920c-88993cc342dd"};function a(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))}var l=function(t){return fetch("".concat(c,"cards/").concat(t),{method:"DELETE",headers:i}).then(a)},s=function(t){return fetch("".concat(c,"cards/").concat(t,"/likes"),{method:"PUT",headers:i}).then(a)},p=function(t){return fetch("".concat(c,"cards/").concat(t,"/likes"),{method:"DELETE",headers:i}).then(a)};function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var f,_=document.querySelector(".group"),m=document.querySelector("#template-element"),y=document.querySelector(".popup_type_avatar"),v=document.querySelector(".profile__avatar-edit"),h=document.querySelector(".profile__avatar"),S=y.querySelector(".popup__form"),b=document.querySelector(".profile__title"),g=document.querySelector(".profile__subtitle"),q=document.querySelector(".profile__button-edit"),E=document.querySelector(".popup_type_profile"),C=E.querySelector(".popup__form"),L=E.querySelector(".popup__input_data_name"),x=E.querySelector(".popup__input_info_name"),k=document.querySelector(".profile__button"),A=document.querySelector(".popup_type_add"),T=A.querySelector(".popup__form"),w=A.querySelector(".popup__input_data_name-add"),j=A.querySelector(".popup__input_url-add"),O=document.querySelector(".popup_type_image"),P=O.querySelector(".popup__image-photo"),D=O.querySelector(".popup__image-title"),B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},N={};function I(t){P.src=t.link,P.alt=t.name,D.textContent=t.name,n(O)}Promise.all([fetch("".concat(c,"users/me"),{method:"GET",headers:i}).then(a),fetch("".concat(c,"cards"),{method:"GET",headers:i}).then(a)]).then((function(e){var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,u,c,i=[],a=!0,l=!1;try{if(u=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=u.call(n)).done)&&(i.push(r.value),i.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{if(!a&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=o[0],c=o[1];b.textContent=u.name,g.textContent=u.about,h.src=u.avatar,N=u,c.forEach((function(e){return _.append(t(e,m,I,N._id,l,s,p))}))})).catch((function(t){return console.log(t)})),q.addEventListener("click",(function(){u(C,B),x.value=g.textContent,L.value=b.textContent,n(E)})),v.addEventListener("click",(function(){n(y),u(S,B)})),S.addEventListener("submit",(function(t){var n;t.preventDefault(),S.querySelector(".popup__button").textContent="Сохранение...",(n={avatar:S.elements.avatar.value},fetch("".concat(c,"users/me/avatar"),{method:"PATCH",headers:i,body:JSON.stringify(n)}).then(a)).then((function(t){v.children[0].src=S.elements.avatar.value,e(y)})).catch((function(t){return console.log(t)})).finally((function(){return S.querySelector(".popup__button").textContent="Сохранить"}))})),C.addEventListener("submit",(function(t){var n;t.preventDefault(),C.querySelector(".popup__button").textContent="Сохранение...",(n={name:L.value,about:x.value},fetch("".concat(c,"users/me"),{method:"PATCH",headers:i,body:JSON.stringify(n)}).then(a)).then((function(t){b.textContent=t.name,g.textContent=t.about,N=t,e(E)})).catch((function(t){return console.log(t)})).finally((function(){return C.querySelector(".popup__button").textContent="Сохранить"}))})),k.addEventListener("click",(function(){u(T,B),n(A)})),A.addEventListener("submit",(function(n){n.preventDefault();var r,o=w.value,u=j.value;A.querySelector(".popup__button").textContent="Сохранение...",(r={name:o,link:u},fetch("".concat(c,"cards"),{method:"POST",headers:i,body:JSON.stringify(r)}).then(a)).then((function(n){var r;r=t(n,m,I,N._id,l,s,p),_.prepend(r),T.reset(),e(A)})).catch((function(t){return console.log(t)})).finally((function(){return A.querySelector(".popup__button").textContent="Сохранить"}))})),document.querySelectorAll(".popup__close").forEach((function(t){var n=t.closest(".popup");t.addEventListener("click",(function(){return e(n)}))})),document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("mousedown",(function(n){n.target==t&&e(t)}))})),f=B,document.querySelectorAll(f.inputSelector).forEach((function(t){t.addEventListener("input",(function(){return function(t,e){var n=e.nextElementSibling,r=e.closest(t.formSelector);if(e.validity.patternMismatch){var u=e.getAttribute("data-error-pattern");e.classList.add(t.inputErrorClass),n.textContent=u}else if(e.validity.valueMissing){var c=e.getAttribute("data-error-required");e.classList.add(t.inputErrorClass),n.textContent=c}else if(e.validity.tooShort||e.validity.tooLong){var i=e.getAttribute("data-error-length");e.classList.add(t.inputErrorClass),n.textContent=i}else e.classList.remove(t.inputErrorClass),n.textContent="";r.querySelector(t.submitButtonSelector).disabled=!o(t,r)}(f,t)}))}))})();